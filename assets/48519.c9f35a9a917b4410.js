"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[48519],{1800:(e,t,r)=>{r.d(t,{B:()=>n,T:()=>o});var o=function(e){return e.INFO_MODAL="info-modal",e.REACHED_LIMIT="reached-limit",e.RESUME_SUBSCRIPTION="resume-subscription",e.START_SUBSCRIPTION="start-subscription",e.TIER_UPGRADE="tier-upgrade",e.WAIT_FOR_PAYMENT_TO_COMPLETE="wait-for-payment-to-complete",e}({});let n={LIMIT_REACHED:"Limit Reached",PAY_FOCUS:"Pay Focus",PAYMENT_PROCESSING:"Payment Processing",RESUME_SUBSCRIPTION:"Resume Subscription",START_SUBSCRIPTION:"Start Subscription",TIER_UPGRADE_PAID:"Tier Upgrade (Paid)",TIER_UPGRADE_TRIAL:"Tier Upgrade (Trial)",UPLOAD_FOCUS:"Upload Focus"}},4310:(e,t,r)=>{r.d(t,{b:()=>d});var o=r(55729),n=r(30955),i=r(3493),a=r(6967),s=r(93349);let d=(e,t)=>{let{config:{appConfigKey:r,appDomains:d},meta:u}=(0,s.K)(),l=(0,i.Y)(),c=(0,a.A)(),m=n.q[t],T=d[r].url;return(0,o.useMemo)(()=>T+l.route("documentViewShortlink",{documentId:e,shareType:m,sid:c,...m===n.q.Facebook?{utm_campaign:"Document_Referral_CONVERT",utm_content:`${u.formatLanguage}_shared_document`,utm_medium:"social",utm_source:"facebook"}:{}}),[l,e,u.formatLanguage,T,m,c])}},10849:(e,t,r)=>{r.d(t,{a:()=>a});var o=r(55729),n=r(27169),i=r(65059);function a(){let[e,t]=(0,o.useState)(1);return(0,n.M)(i.q7,e=>{e.detail>0&&t(e.detail)},(0,n.o)()?window:null),{currentPage:e}}},14309:(e,t,r)=>{r.d(t,{j:()=>o});let o={AUTHENTICATE_SAVE_DOCUMENT:"authenticateSaveDocument",EXIT_VIEWER_POPUP:"exitViewerPopup",PAYMENT_MODAL:"paymentModal",REPORT:"report",SAVE:"save",SHARE:"share"}},16966:(e,t,r)=>{r.d(t,{D:()=>i});var o=r(55729),n=r(48939);let i=()=>{let e=(0,n.u)(),t=(0,o.useCallback)(t=>((e,t)=>{let r=((e,t)=>{if(t&&"object"==typeof t){let r=[t?.response?.data,t?.response?.data?.error,t?.error?.message].find(e=>"string"==typeof e);return r||(t?.response?.data?.error?.message??[e.get("error_generic")])}return[e.get("error_generic")]})(e,t);return"string"==typeof r?[r]:Object.values(r).flat()})(e,t),[e]);return(0,o.useMemo)(()=>({parseResponseErrorMessages:t}),[t])}},37471:(e,t,r)=>{r.d(t,{A:()=>L});var o=r(6029),n=r(12464),i=r(71024),a=r.n(i),s=r(99486),d=r(75715),u=r(16148),l=r(41206),c=r(93591),m=r(38251),T=r(48939),E=r(93349),D=r(10849),U=r(73172),I=r(69120),_=r(20622),R=r(1800),S=r(28586),g=r(3493),A=r(83965),P=r(57481),O=r(11065),w=r(51097),p=r(8650),y=r(43106),C=r(73230),M=r(95433),h=r(82670);let N=a()(()=>r.e(52968).then(r.bind(r,52968)),{loadableGenerated:{webpack:()=>[52968]}}),L=function(e){let{activeSubscription:t,document:r,documentAbilities:i,loading:a=!1,modalProps:L,origin:f,showTextOnMobile:v=!0,userStage:b}=e,j=(0,T.u)(),{currentPage:Y}=(0,D.a)(),{session:{user:k}}=(0,E.K)(),B=function(e){let{activeSubscription:t,documentAbilities:r,isPremium:o,userPremiumTier:n}=e;if(!r)return R.T.INFO_MODAL;if(t?.pause&&t?.id&&t.paymentMethod?.brandCode)return R.T.RESUME_SUBSCRIPTION;let{canDownloadReason:i}=r;return i===I.M$.HOURLY_LIMIT_REACHED||i===I.M$.DAILY_LIMIT_REACHED||i===I.M$.MONTHLY_LIMIT_REACHED?n===_.WN.light?R.T.TIER_UPGRADE:R.T.REACHED_LIMIT:!r.canDownload&&!t?.id&&o&&n?R.T.WAIT_FOR_PAYMENT_TO_COMPLETE:i===I.M$.USER_IS_IN_TRIAL&&t?.id?R.T.START_SUBSCRIPTION:R.T.INFO_MODAL}({activeSubscription:t,documentAbilities:i,isPremium:k?.isPremium??!1,userPremiumTier:k?.userPremiumTier??null}),{disabled:F,handleRedirect:H,isLoading:V,shouldShowDownloadModal:x,trackDownloadClicked:G}=function(e){let{activeSubscription:t,document:r,documentAbilities:o,loading:n=!1,modalVariant:i,user:a,userStage:s}=e,d=(0,g.Y)(),{id:u}=r,l=(0,P.Lt)(r),c=function(e,t,r){if(!e)return{};let o=(0,C.P)(t?.institution),n=(0,C.P)(e.institution);return{"Academic Year":e.additionalDetails.academicYear,"Category ID":e.categoryId,"Category Name":(0,y.lm)(e.categoryId),"Document ID":e.id,Downloads:e.downloads,"Last Download Attempt Document ID":e.id,Premium:e.isPremium,Rating:e.rating,Title:e.title,"Upload Date":e.createdAt?(0,O.aG)(e.createdAt).toISOString():"",...e.course?.code&&{"Course Code":e.course.code},...e.course?.id&&{"Course ID":e.course.id},...e.course?.name&&{"Course Name":e.course.name},...t?.country?.id&&{"User Country ID":t.country.id},...t?.country?.name&&{"User Country Name":t.country.name},...t?.degree?.id&&{"User Degree ID":t.degree.id},...t?.degree?.name&&{"User Degree Name":t.degree.name},...t?.degree?.shortName&&{"User Degree Short Name":t.degree.shortName},...t?.degree?.stage&&{"User Degree Stage":t.degree.stage},...t?.id&&{"User ID":t.id},...t?.isVerifiedStudent!==void 0&&{"User Is Verified Student":t.isVerifiedStudent},...t?.language&&{"User Language":t.language.code},...t?.hasActivatedPrimaryEmail!==void 0&&{"User Primary Email Is Activated":t.hasActivatedPrimaryEmail},...t?.studyYear&&{"User Start Year":t.studyYear},...t?.institution?.country?.id&&{"User University Country ID":t.institution.country.id},...t?.institution?.country?.name&&{"User University Country Name":t.institution.country.name},...t?.institution?.id&&{"User University ID":t.institution.id},...!(0,w.b0)(o)&&{"User University Level":o},...t?.institution?.name&&{"User University Name":t.institution.name},...t?.institution?.stage&&{"User University Stage":t.institution.stage},...t?.region?.code&&{"User Url Region":t.region.code},...t?.userPremiumTier&&{"User Premium Tier":(0,p.aL)(t.userPremiumTier.replaceAll("-"," "))},...t?.userPremiumTier===_.WN.light&&{"Modal Type":"Subscription Tier Upgrade"},...e.institution&&{"University ID":e.institution.id,"University Name":e.institution.name,...e.institution.country&&{"University Country ID":e.institution.country.id,"University Country Name":(0,M.A)(e.institution.country.id)},"University Stage":e.institution.stage,...!(0,w.b0)(n)&&{"University Level":n}},...r&&{"Download Modal Type":r}}}(r,a,function(e,t,r){if(e)switch(e){case R.T.RESUME_SUBSCRIPTION:return R.B.RESUME_SUBSCRIPTION;case R.T.REACHED_LIMIT:return R.B.LIMIT_REACHED;case R.T.TIER_UPGRADE:return t?.paymentPlan?.isTrial?R.B.TIER_UPGRADE_TRIAL:R.B.TIER_UPGRADE_PAID;case R.T.WAIT_FOR_PAYMENT_TO_COMPLETE:return R.B.PAYMENT_PROCESSING;case R.T.START_SUBSCRIPTION:return R.B.START_SUBSCRIPTION;case R.T.INFO_MODAL:if(r)return"Pay"===(0,h.r)(r)?R.B.PAY_FOCUS:R.B.UPLOAD_FOCUS;return R.B.UPLOAD_FOCUS;default:return}}(i,t,s)),m=(0,A.V)(u,c),T=function(e){let{handleDownloadDocument:t,isDownloadAuthorized:r,trackDownloadClicked:o,uploaderUrl:n}=e;return(e,i,a)=>{r?(o(i,a),t()):(0,S.Dc)(e,()=>o(i,a),n)}}({handleDownloadDocument:l,isDownloadAuthorized:o?.canDownload??!1,trackDownloadClicked:m,uploaderUrl:d.route("documentUpload",{origin:"download-button"})});return{disabled:!o,handleRedirect:T,isLoading:!o||n,shouldShowDownloadModal:!o?.canDownload,trackDownloadClicked:m}}({activeSubscription:t,document:r,documentAbilities:i,loading:a,modalVariant:B,user:k,userStage:b}),{hideAndRemoveModal:$,isRenderingModal:W,isShowingModal:K,renderAndShowModal:q}=(0,m.A)(),X={addon:(0,o.jsx)(s.I,{icon:n.uqk,testSelector:"download-icon-toolbar"}),"aria-label":j.get("download"),color:"green",disabled:F,loading:V,onClick:e=>(l.g.setItem(c.r.MOST_RECENTLY_VIEWED_DOCUMENT,window.location.href,l.K),x)?void(q(),G(f,Y)):H(e,f,Y),size:"medium",variant:"primary"};return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:(0,d.R)("on-mobile"),children:(0,o.jsx)(u.$,{...X,testSelector:"download-button",children:(0,o.jsx)(U.A,{id:"download"})})}),(0,o.jsx)("div",{className:(0,d.R)("from-tablet"),children:(0,o.jsx)(u.$,{...X,testSelector:"download-button-mobile",children:v&&(0,o.jsx)(U.A,{id:"download"})})}),W&&(0,o.jsx)(N,{activeSubscription:t,canDownloadReason:i?.canDownloadReason,document:r,modalProps:L,modalVariant:B,onHide:()=>{$()},show:K,userStage:b})]})}},48990:(e,t,r)=>{r.d(t,{K:()=>s});var o=r(90087),n=r(79967),i=r(36699),a=r(16966);let s=()=>{let e=(0,i.i)(),{parseResponseErrorMessages:t}=(0,a.D)(),{mutateAsync:r,...s}=(0,o.MX)();return{...s,updateSubscription:o=>{let{activeSubscriptionId:i,onSuccess:a,paymentPlanId:s,reloadPage:d}=o;return r({data:{isTrial:!1,...s&&{paymentPlanId:s}},headers:e,subscription:i},{onError:e=>{(0,n.$U)({message:t(e),type:"error"})},onSettled:()=>{d&&window.location.reload()},onSuccess:a})}}}},50281:(e,t,r)=>{r.d(t,{F:()=>u});var o=r(90087),n=r(36699),i=r(16966),a=r(93349),s=r(11331),d=r(79967);let u=()=>{let{session:e}=(0,a.K)(),t=(0,n.i)(),r=(0,s.jt)(),{parseResponseErrorMessages:u}=(0,i.D)(),{mutateAsync:l,...c}=(0,o.MX)();return{...c,paymentSubmitFinishTrial:o=>{let{activeSubscriptionId:n,documentId:i,origin:a,reloadPage:s}=o;return l({data:{isTrial:!1},headers:t,subscription:n},{onError:e=>{(0,d.$U)({message:u(e),type:"error"})},onSettled:()=>{s&&window.location.reload()},onSuccess:()=>{r("Subscription Started",{...a&&{Origin:a},...i&&{"Document ID":i},...e?.user?.id&&{"User ID":e.user.id}})}})}}}},57481:(e,t,r)=>{r.d(t,{Lt:()=>U});var o=r(79539),n=r(35661),i=r(32003),a=r(59795),s=r(36699),d=r(48939),u=r(3493),l=r(11331),c=r(50974),m=r(59834),T=r(37967),E=r(79967);let D={DOWNLOAD_DOCUMENT:"Document Download",DOWNLOAD_DOCUMENT_ERROR:"Document Download Error"},U=e=>{let t=(0,a.H)(),r=(0,l.jt)(),o=(0,d.u)(),n=(0,s.i)(),i=(0,u.Y)(),c=i.route("documentGetURL",{id:e.id}),m=i.route("api.temp.tracking.documents.download");return()=>I(t,c,e,n).then(t=>{t?_(m,e.id,r):(R(e.id,r),(0,E.$U)({message:o.get("error_generic"),type:"error"}))})};async function I(e,t,r,n){let a=window.open("about:blank");try{if(!r.course)throw Error("Document does not have a course");let{origin:i}=window.location,s={courseURL:i+e.course(r.course),documentShortURL:i+t,documentURL:i+e.document(r),landingURL:`${i}/${window.location.pathname.split("/")[1]}`},d=await (0,o.E)(r.id,s,n,{headers:{Accept:"application/pdf"},responseType:"blob"}),u=URL.createObjectURL(d);return a&&(a.location.href=u,a.focus()),!0}catch(t){let e=Error("Error downloading a document.",{cause:t});return(0,m.w)(e,i.n.CRITICAL),a?.close(),console.error(e),!1}}async function _(e,t,r){try{let o=await fetch((0,n.Rj)(window.location.origin+e,{documentId:t}),{headers:(0,T.M)()}),{properties:i}=await o.json();r(D.DOWNLOAD_DOCUMENT,{...i})}catch(e){(0,c.Vt)(Error("Error tracking a document download.",{cause:e})),console.error(e)}}async function R(e,t){t(D.DOWNLOAD_DOCUMENT_ERROR,{"Document ID":e})}},83965:(e,t,r)=>{r.d(t,{V:()=>m});var o=r(33242),n=r(55729),i=r(51097),a=r(63706),s=r(37967),d=r(3493),u=r(93349),l=r(11331);let c="Document Download Clicked";function m(e,t){let r=(0,l.jt)(),{ab:m}=(0,u.K)(),T=(0,d.Y)(),E=(0,a.A)(),D=m.find(e=>{let{test:t}=e;return"testTieredPremium"===t})?.variant,U=m.find(e=>{let{test:t}=e;return"testTieredPremiumCoreMarket"===t})?.variant,I=m.find(e=>{let{test:t}=e;return"testTieredPremiumRow"===t})?.variant,_=m.find(e=>{let{test:t}=e;return"testShowingPaymentModalFromDownload"===t})?.variant,R=(0,o.useMutation)({mutationFn:e=>{let{documentId:t}=e;return fetch(T.route("api.metrics.downloadclicks.store",{documentId:t}),{headers:(0,s.M)(),method:"POST"})}});return(0,n.useCallback)((o,n)=>Promise.all([R.mutateAsync({documentId:e}),r(c,{...t,...(0,i.hj)(n)&&{"Current Document Page":n},Origin:o,...D&&{"Test Tiered Premium":D},...U&&{"Test Tiered Premium Core Market":U},...I&&{"Test Tiered Premium Row":I},..._&&{"Test Showing Payment Modal From Download":_}}),E(e,c)]),[e,E,t,R,U,I,_,D,r])}},84965:(e,t,r)=>{r.d(t,{Y0:()=>l,b_:()=>d,fj:()=>s});var o=r(55729),n=r(55491),i=r(14309);let a={CLOSE:"doc-modal-close",OPEN:"doc-modal-open"},s=e=>document.dispatchEvent(new CustomEvent(a.OPEN,{detail:e})),d=e=>document.dispatchEvent(new CustomEvent(a.CLOSE,{detail:e})),u=Object.values(i.j).reduce((e,t)=>({...e,[t]:{show:!1}}),{}),l=()=>{let[e,t]=(0,o.useState)(u),r=(0,n.oc)()?document:null;return(0,n.ML)(a.OPEN,e=>{let{additionalData:r,modalType:o}=e.detail;if((0,n.Im)(o))throw Error("Modal type doesn't exist");t(e=>({...e,[o]:{show:!0,...r}}))},r),(0,n.ML)(a.CLOSE,e=>{let r=e.detail;if((0,n.Im)(r))throw Error("Modal type doesn't exist");t(e=>({...e,[r]:{show:!1}}))},r),{modalState:e}}},95433:(e,t,r)=>{r.d(t,{A:()=>n});var o=r(15299);let n=e=>o.w4[e]},97925:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(55729),n=r(93349),i=r(11331);function a(){let e=(0,i.jt)(),{session:{user:t}}=(0,n.K)(),r=t?.institution?.phase;return(0,o.useCallback)(()=>e("Download To Upload Modal Dismissed",{"User University Stage":r}),[e,r])}}}]);